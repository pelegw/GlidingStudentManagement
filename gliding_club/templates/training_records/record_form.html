{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set up event listeners for the exercise options
    const setupExerciseOptions = () => {
        const options = document.querySelectorAll('.exercise-option');
        options.forEach(option => {
            option.addEventListener('click', function() {
                const formId = this.dataset.formId;
                const value = this.dataset.value;
                
                // Find all options for this exercise and remove selected class
                const siblingOptions = document.querySelectorAll(`.exercise-option[data-form-id="${formId}"]`);
                siblingOptions.forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to the clicked option
                this.classList.add('selected');
                
                // Set the corresponding radio input
                const radioInput = document.querySelector(`input[id="${formId}-${value}"]`);
                if (radioInput) {
                    radioInput.checked = true;
                }
                
                // Show/hide notes field based on selection
                const notesContainer = document.getElementById(`notes-${formId}`);
                if (notesContainer) {
                    if (value === 'performed_well' || value === 'needs_improvement') {
                        notesContainer.classList.add('visible');
                    } else {
                        notesContainer.classList.remove('visible');
                    }
                }
            });
        });
    };
    
    // Initialize options based on existing performances (for edit view)
    const initializeExistingPerformances = () => {
        // This is a way to pass the existing performance data from Django to JavaScript
        {% if existing_performances %}
            const existingPerformances = {{ existing_performances|safe }};
            
            for (const [exerciseId, data] of Object.entries(existingPerformances)) {
                // Find the exercise item by exercise ID
                const exerciseItems = document.querySelectorAll(`input[name$="-exercise"][value="${exerciseId}"]`);
                
                exerciseItems.forEach(item => {
                    const formId = item.name.split('-exercise')[0];
                    
                    // Set the radio button
                    const radioInput = document.querySelector(`input[id="${formId}-${data.performance}"]`);
                    if (radioInput) {
                        radioInput.checked = true;
                    }
                    
                    // Highlight the selected option
                    const option = document.querySelector(`.exercise-option[data-form-id="${formId}"][data-value="${data.performance}"]`);
                    if (option) {
                        option.classList.add('selected');
                    }
                    
                    // Set notes and show notes field if needed
                    const notesField = document.querySelector(`textarea[name="${formId}-notes"]`);
                    if (notesField && data.notes) {
                        notesField.value = data.notes;
                    }
                    
                    const notesContainer = document.getElementById(`notes-${formId}`);
                    if (notesContainer && (data.performance === 'performed_well' || data.performance === 'needs_improvement')) {
                        notesContainer.classList.add('visible');
                    }
                });
            }
        {% else %}
            // For new records, initialize all options as "Not Performed" (selected)
            document.querySelectorAll('.exercise-option[data-value="not_performed"]').forEach(option => {
                option.classList.add('selected');
            });
        {% endif %}
    };
    
    // Initialize the UI
    setupExerciseOptions();
    initializeExistingPerformances();
    
    // Add Bootstrap form classes to all form inputs
    const formElements = document.querySelectorAll('input:not([type="radio"]), select, textarea');
    formElements.forEach(element => {
        if (!element.classList.contains('form-control') && 
            !element.classList.contains('form-select') && 
            !element.classList.contains('form-check-input') &&
            !element.classList.contains('d-none')) {
            
            if (element.tagName === 'SELECT') {
                element.classList.add('form-select');
            } else if (element.type === 'checkbox') {
                element.classList.add('form-check-input');
            } else {
                element.classList.add('form-control');
            }
        }
    });
});
</script>
{% endblock %}